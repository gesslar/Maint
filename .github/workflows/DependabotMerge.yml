name: Auto-merge Dependabot PRs

on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:     # Manual trigger

jobs:
  auto-merge:
    runs-on: ubuntu-latest
    steps:
      - name: Auto-merge Dependabot PRs
        env:
          GH_TOKEN: ${{ secrets.WORKFLOW_MAINT }}
        run: |
          for repo in $(gh repo list ${{ github.repository_owner }} --json nameWithOwner -q '.[].nameWithOwner'); do
            echo "Checking $repo..."
            gh repo set-default $repo
            PRs=$(gh pr list --state open --json number,author,title -q '.[] | select(.author.login=="dependabot[bot]") | .number')
            if [ ! -z "$PRs" ]; then
              echo "$PRs" | while read pr; do
                echo "â†’ Commenting on PR #$pr"
                gh pr comment $pr --body "@dependabot merge"
              done
            fi
          done
